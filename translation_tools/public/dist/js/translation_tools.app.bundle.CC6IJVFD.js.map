{
  "version": 3,
  "sources": ["../../../../../apps/translation_tools/translation_tools/public/js/app.js"],
  "sourcesContent": ["frappe.provide(\"translation_tools\");\n\ntranslation_tools.setup_integration_button = function () {\n  console.log(\"Translation Tools: Checking for Integrations page\");\n\n  // Check if we're on the Integrations page\n  const currentPath = window.location.pathname;\n  const isIntegrationsPage =\n    currentPath === \"/app/integrations\" ||\n    currentPath.endsWith(\"/app/integrations\") ||\n    (frappe.router &&\n      frappe.router.current_route &&\n      frappe.router.current_route.length > 0 &&\n      frappe.router.current_route[0] === \"Integrations\");\n  console.log(\"isIntegrationsPage\", isIntegrationsPage);\n\n  if (isIntegrationsPage) {\n    console.log(\n      \"Translation Tools: On Integrations page, checking for existing link\"\n    );\n\n    // First check if button already exists to avoid duplicates\n    if ($(\"#trigger-translation-tools\").length > 0) return;\n\n    // Add a flag to the sessionStorage to prevent reload loops\n    if (sessionStorage.getItem(\"translation_tools_reload_executed\")) {\n      console.log(\"Translation Tools: Reload already executed, skipping\");\n      sessionStorage.removeItem(\"translation_tools_reload_executed\");\n      return;\n    }\n\n    frappe.call({\n      method: \"translation_tools.api.integrations.check_translation_tools_link\",\n      args: {},\n      callback: function (r) {\n        console.log(\"Translation Tools: Link check response\", r);\n\n        if (r.message && !r.message.link_exists) {\n          console.log(\"Translation Tools: Link doesn't exist, adding button\");\n\n          var button = $(\n            \"<button class='btn btn-primary mt-3 mb-3' id='trigger-translation-tools'>Add Translation Tools to Integration</button>\"\n          );\n\n          button.on(\"click\", function () {\n            frappe.call({\n              method:\n                \"translation_tools.api.integrations.add_translation_tools_link_to_integrations\",\n              args: {},\n              callback: function (r) {\n                console.log(\"Translation Tools: Add link response\", r);\n\n                if (r.message && r.message.success) {\n                  frappe.show_alert({\n                    message: __(\"Translation Tools link added successfully!\"),\n                    indicator: \"green\",\n                  });\n\n                  // Set a flag to prevent reload loops\n                  sessionStorage.setItem(\n                    \"translation_tools_reload_executed\",\n                    \"true\"\n                  );\n\n                  // Force a complete page reload rather than just refreshing\n                  setTimeout(function () {\n                    // frappe.ui.toolbar.clear_cache();\n                    window.location.reload(true); // True forces reload from server, not cache\n                  }, 1500);\n                } else {\n                  frappe.msgprint(\n                    __(\n                      \"Error: \" +\n                        (r.message && r.message.error\n                          ? r.message.error\n                          : \"Unknown error\")\n                    )\n                  );\n                }\n              },\n            });\n          });\n\n          // Add the button to various possible locations\n          setTimeout(function () {\n            var added = false;\n\n            // Try different places to add the button\n            if ($(\".layout-main-section\").length) {\n              $(\".layout-main-section\").prepend(button);\n              added = true;\n            } else if ($(\".workspace-sidebar\").length) {\n              $(\".workspace-sidebar\").prepend(button);\n              added = true;\n            } else if ($(\".page-head\").length) {\n              $(\".page-head\").append(button);\n              added = true;\n            }\n\n            if (!added) {\n              console.log(\n                \"No suitable container found, adding floating button\"\n              );\n              $(\"body\").append(\n                \"<div style='position:fixed;top:100px;right:20px;z-index:9999;'>\" +\n                  button[0].outerHTML +\n                  \"</div>\"\n              );\n            }\n          }, 1000);\n        } else {\n          console.log(\n            \"Translation Tools: Link already exists or error occurred\"\n          );\n        }\n      },\n    });\n\n    // Clear Workspace Cache\n    // frappe.call({\n    //   method: \"translation_tools.api.integrations.clear_workspace_cache\",\n    //   callback: function () {\n    //     frappe.show_alert({\n    //       message: __(\n    //         \"Translation Tools link added and cache cleared. Refreshing...\"\n    //       ),\n    //       indicator: \"green\",\n    //     });\n\n    //     setTimeout(function () {\n    //       window.location.reload(true);\n    //     }, 1500);\n    //   },\n    // });\n  }\n};\n\n// Run when DOM is ready\n$(document).ready(function () {\n  console.log(\"Translation Tools: Document ready\");\n  setTimeout(translation_tools.setup_integration_button, 2000);\n});\n\n// Also run when route changes\n$(document).on(\"route_change\", function () {\n  console.log(\"Translation Tools: Route changed\");\n  setTimeout(translation_tools.setup_integration_button, 2000);\n});\n"],
  "mappings": ";;AAAA,SAAO,QAAQ,mBAAmB;AAElC,oBAAkB,2BAA2B,WAAY;AACvD,YAAQ,IAAI,mDAAmD;AAG/D,UAAM,cAAc,OAAO,SAAS;AACpC,UAAM,qBACJ,gBAAgB,uBAChB,YAAY,SAAS,mBAAmB,KACvC,OAAO,UACN,OAAO,OAAO,iBACd,OAAO,OAAO,cAAc,SAAS,KACrC,OAAO,OAAO,cAAc,OAAO;AACvC,YAAQ,IAAI,sBAAsB,kBAAkB;AAEpD,QAAI,oBAAoB;AACtB,cAAQ;AAAA,QACN;AAAA,MACF;AAGA,UAAI,EAAE,4BAA4B,EAAE,SAAS;AAAG;AAGhD,UAAI,eAAe,QAAQ,mCAAmC,GAAG;AAC/D,gBAAQ,IAAI,sDAAsD;AAClE,uBAAe,WAAW,mCAAmC;AAC7D;AAAA,MACF;AAEA,aAAO,KAAK;AAAA,QACV,QAAQ;AAAA,QACR,MAAM,CAAC;AAAA,QACP,UAAU,SAAU,GAAG;AACrB,kBAAQ,IAAI,0CAA0C,CAAC;AAEvD,cAAI,EAAE,WAAW,CAAC,EAAE,QAAQ,aAAa;AACvC,oBAAQ,IAAI,sDAAsD;AAElE,gBAAI,SAAS;AAAA,cACX;AAAA,YACF;AAEA,mBAAO,GAAG,SAAS,WAAY;AAC7B,qBAAO,KAAK;AAAA,gBACV,QACE;AAAA,gBACF,MAAM,CAAC;AAAA,gBACP,UAAU,SAAUA,IAAG;AACrB,0BAAQ,IAAI,wCAAwCA,EAAC;AAErD,sBAAIA,GAAE,WAAWA,GAAE,QAAQ,SAAS;AAClC,2BAAO,WAAW;AAAA,sBAChB,SAAS,GAAG,4CAA4C;AAAA,sBACxD,WAAW;AAAA,oBACb,CAAC;AAGD,mCAAe;AAAA,sBACb;AAAA,sBACA;AAAA,oBACF;AAGA,+BAAW,WAAY;AAErB,6BAAO,SAAS,OAAO,IAAI;AAAA,oBAC7B,GAAG,IAAI;AAAA,kBACT,OAAO;AACL,2BAAO;AAAA,sBACL;AAAA,wBACE,aACGA,GAAE,WAAWA,GAAE,QAAQ,QACpBA,GAAE,QAAQ,QACV;AAAA,sBACR;AAAA,oBACF;AAAA,kBACF;AAAA,gBACF;AAAA,cACF,CAAC;AAAA,YACH,CAAC;AAGD,uBAAW,WAAY;AACrB,kBAAI,QAAQ;AAGZ,kBAAI,EAAE,sBAAsB,EAAE,QAAQ;AACpC,kBAAE,sBAAsB,EAAE,QAAQ,MAAM;AACxC,wBAAQ;AAAA,cACV,WAAW,EAAE,oBAAoB,EAAE,QAAQ;AACzC,kBAAE,oBAAoB,EAAE,QAAQ,MAAM;AACtC,wBAAQ;AAAA,cACV,WAAW,EAAE,YAAY,EAAE,QAAQ;AACjC,kBAAE,YAAY,EAAE,OAAO,MAAM;AAC7B,wBAAQ;AAAA,cACV;AAEA,kBAAI,CAAC,OAAO;AACV,wBAAQ;AAAA,kBACN;AAAA,gBACF;AACA,kBAAE,MAAM,EAAE;AAAA,kBACR,oEACE,OAAO,GAAG,YACV;AAAA,gBACJ;AAAA,cACF;AAAA,YACF,GAAG,GAAI;AAAA,UACT,OAAO;AACL,oBAAQ;AAAA,cACN;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IAkBH;AAAA,EACF;AAGA,IAAE,QAAQ,EAAE,MAAM,WAAY;AAC5B,YAAQ,IAAI,mCAAmC;AAC/C,eAAW,kBAAkB,0BAA0B,GAAI;AAAA,EAC7D,CAAC;AAGD,IAAE,QAAQ,EAAE,GAAG,gBAAgB,WAAY;AACzC,YAAQ,IAAI,kCAAkC;AAC9C,eAAW,kBAAkB,0BAA0B,GAAI;AAAA,EAC7D,CAAC;",
  "names": ["r"]
}
